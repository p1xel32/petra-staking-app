"use strict";var u=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var x=Object.prototype.hasOwnProperty;var A=(e,r)=>{for(var i in r)u(e,i,{get:r[i],enumerable:!0})},E=(e,r,i,s)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of _(r))!x.call(e,t)&&t!==i&&u(e,t,{get:()=>r[t],enumerable:!(s=h(r,t))||s.enumerable});return e};var b=e=>E(u({},"__esModule",{value:!0}),e);var j={};A(j,{SERIALIZATION_VERSION:()=>l,createSignInMessageText:()=>w,deserializeSignInOutput:()=>C,deserializeSignInPublicKey:()=>c,deserializeSignInSignature:()=>g,generateNonce:()=>H,generateSignInSigningMessage:()=>S,getSignInPublicKeyScheme:()=>B,isValidPublicKeyScheme:()=>d,parseSignInMessageText:()=>y,serializeSignInOutput:()=>F,verifySignIn:()=>D,verifySignInMessage:()=>I});module.exports=b(j);var p=require("@noble/hashes/sha3");function f(e,r,i){if(e===r)return!0;let s=e.length;if(s!==r.length)return!1;for(let t=0;t<s;t++)if(!i?.includes(e[t])&&e[t]!==r[t])return!1;return!0}function m(e){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="";for(let s=0;s<e.byteLength;s+=3){let t=0,a=0;for(let o=0;o<3&&s+o<e.byteLength;o++)t=t<<8|e[s+o],a+=8;for(let o=0;o<4;o++)a>=6?(i+=r[t>>a-6&63],a-=6):a>0&&(i+=r[t<<6-a&63],a=0)}return i}function w(e){let r=`${e.domain} wants you to sign in with your Aptos account:
`;r+=`${e.address}`,e.statement&&(r+=`

${e.statement}`);let i=[];if(e.uri&&i.push(`URI: ${e.uri}`),e.version&&i.push(`Version: ${e.version}`),e.nonce&&i.push(`Nonce: ${e.nonce}`),e.issuedAt&&i.push(`Issued At: ${e.issuedAt}`),e.expirationTime&&i.push(`Expiration Time: ${e.expirationTime}`),e.notBefore&&i.push(`Not Before: ${e.notBefore}`),e.requestId&&i.push(`Request ID: ${e.requestId}`),e.chainId&&i.push(`Chain ID: ${e.chainId}`),e.resources){i.push("Resources:");for(let s of e.resources)i.push(`- ${s}`)}return i.length&&(r+=`

${i.join(`
`)}`),r}var $="(?<domain>[^\\n]+?) wants you to sign in with your Aptos account:\\n",R="(?<address>[^\\n]+)(?:\\n|$)",T="(?:\\n(?<statement>[\\S\\s]*?)(?:\\n|$))??",K="(?:\\nURI: (?<uri>[^\\n]+))?",k="(?:\\nVersion: (?<version>[^\\n]+))?",v="(?:\\nNonce: (?<nonce>[^\\n]+))?",z="(?:\\nIssued At: (?<issuedAt>[^\\n]+))?",V="(?:\\nExpiration Time: (?<expirationTime>[^\\n]+))?",O="(?:\\nNot Before: (?<notBefore>[^\\n]+))?",M="(?:\\nRequest ID: (?<requestId>[^\\n]+))?",U="(?:\\nChain ID: (?<chainId>[^\\n]+))?",N="(?:\\nResources:(?<resources>(?:\\n- [^\\n]+)*))?",q=`${K}${k}${v}${z}${V}${O}${M}${U}${N}`,P=new RegExp(`^${$}${R}${T}${q}\\n*$`);function y(e){let r=P.exec(e);if(!r)return{valid:!1,errors:["invalid_message"]};let i=r.groups;if(!i)return{valid:!1,errors:["invalid_message"]};let s=[];return(!i.domain||i.domain==="undefined")&&s.push("message_domain_missing"),(!i.address||i.address==="undefined")&&s.push("message_address_missing"),(!i.version||i.version==="undefined")&&s.push("message_version_missing"),(!i.chainId||i.chainId==="undefined")&&s.push("message_chain_id_missing"),s.length?{valid:!1,errors:s}:{valid:!0,data:{domain:i.domain,address:i.address,statement:i.statement,uri:i.uri,version:i.version,nonce:i.nonce,chainId:i.chainId,issuedAt:i.issuedAt,expirationTime:i.expirationTime,notBefore:i.notBefore,requestId:i.requestId,resources:i.resources?.split(`
- `).slice(1)}}}function I(e,r,i){let s=y(r);if(!s.valid)return s;let t=[];return e.address&&e.address!==s.data.address&&t.push("message_address_mismatch"),e.statement!==s.data.statement&&t.push("message_statement_mismatch"),e.uri&&e.uri!==s.data.uri&&t.push("message_uri_mismatch"),e.version&&e.version!==s.data.version&&t.push("message_version_mismatch"),e.chainId&&e.chainId!==s.data.chainId&&t.push("message_chain_id_mismatch"),e.nonce!==s.data.nonce&&t.push("message_nonce_mismatch"),e.issuedAt!==s.data.issuedAt&&t.push("message_issued_at_mismatch"),e.expirationTime!==s.data.expirationTime&&t.push("message_expiration_time_mismatch"),e.notBefore!==s.data.notBefore&&t.push("message_not_before_mismatch"),e.requestId!==s.data.requestId&&t.push("message_request_id_mismatch"),e.domain&&e.domain!==s.data.domain&&t.push("message_domain_mismatch"),e.resources?s.data.resources?f(e.resources,s.data.resources,i?.excludedResources)||t.push("message_resources_mismatch"):t.push("message_resources_missing"):s.data.resources&&t.push("message_resources_unexpected"),t.length?{valid:!1,errors:t}:{valid:!0,data:s.data}}function D(e,r,i){let s=I(e,r.message,i);return s.valid?r.publicKey.verifySignature({message:S(r.message),signature:r.signature})?{valid:!0,data:s.data}:{valid:!1,errors:["invalid_signature"]}:s}function S(e){let i=(0,p.sha3_256)("SIGN_IN_WITH_APTOS::");return new Uint8Array([...i,...new TextEncoder().encode(e)])}var n=require("@aptos-labs/ts-sdk");var d=e=>e==="ed25519"||e==="multi_ed25519"||e==="single_key"||e==="multi_key";function B(e){if(typeof e=="object"){if(n.Ed25519PublicKey.isInstance(e))return"ed25519";if(n.AnyPublicKey.isInstance(e))return"single_key";if(n.MultiKey.isInstance(e))return"multi_key";if(e instanceof n.MultiEd25519PublicKey)return"multi_ed25519";throw new Error(`Unknown public key type for instance: ${e}`)}switch(e){case n.SigningScheme.Ed25519:return"ed25519";case n.SigningScheme.MultiEd25519:return"multi_ed25519";case n.SigningScheme.SingleKey:return"single_key";case n.SigningScheme.MultiKey:return"multi_key";default:throw new Error(`Unknown public key type for signing scheme: ${e}`)}}function c(e,r){let i=new n.Deserializer(n.Hex.fromHexInput(r).toUint8Array());if(typeof e!="string")switch(e){case n.SigningScheme.Ed25519:return n.Ed25519PublicKey.deserialize(i);case n.SigningScheme.MultiEd25519:return n.MultiEd25519PublicKey.deserialize(i);case n.SigningScheme.SingleKey:return n.AnyPublicKey.deserialize(i);case n.SigningScheme.MultiKey:return n.MultiKey.deserialize(i);default:throw new Error(`Unknown public key type for signing scheme: ${e}`)}switch(e){case"ed25519":return n.Ed25519PublicKey.deserialize(i);case"multi_ed25519":return n.MultiEd25519PublicKey.deserialize(i);case"single_key":return n.AnyPublicKey.deserialize(i);case"multi_key":return n.MultiKey.deserialize(i);default:throw new Error(`Unknown public key type: ${e}`)}}function g(e,r){let i=new n.Deserializer(n.Hex.fromHexInput(r).toUint8Array());if(typeof e!="string")switch(e){case n.SigningScheme.Ed25519:return n.Ed25519Signature.deserialize(i);case n.SigningScheme.MultiEd25519:return n.MultiEd25519Signature.deserialize(i);case n.SigningScheme.SingleKey:return n.AnySignature.deserialize(i);case n.SigningScheme.MultiKey:return n.MultiKeySignature.deserialize(i);default:throw new Error(`Unknown signature type for signing scheme: ${e}`)}switch(e){case"ed25519":return n.Ed25519Signature.deserialize(i);case"multi_ed25519":return n.MultiEd25519Signature.deserialize(i);case"single_key":return n.AnySignature.deserialize(i);case"multi_key":return n.MultiKeySignature.deserialize(i);default:throw new Error(`Unknown signature type: ${e}`)}}function H(){let e=new Uint8Array(12);return crypto.getRandomValues(e),m(e)}var l="1",F=e=>({version:l,type:e.type,signature:e.signature.bcsToHex().toString(),message:e.plainText,publicKey:e.account.publicKey.bcsToHex().toString()}),C=e=>{let{version:r}=e;if(r===l){if(!d(e.type))throw new Error(`Unexpected public key scheme: ${e.type}`);return{type:e.type,signature:g(e.type,e.signature),publicKey:c(e.type,e.publicKey),message:e.message}}throw new Error(`Unexpected serialization version: ${r}`)};0&&(module.exports={SERIALIZATION_VERSION,createSignInMessageText,deserializeSignInOutput,deserializeSignInPublicKey,deserializeSignInSignature,generateNonce,generateSignInSigningMessage,getSignInPublicKeyScheme,isValidPublicKeyScheme,parseSignInMessageText,serializeSignInOutput,verifySignIn,verifySignInMessage});
//# sourceMappingURL=index.cjs.map