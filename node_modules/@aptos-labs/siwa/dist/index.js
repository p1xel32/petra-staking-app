import{sha3_256 as b}from"@noble/hashes/sha3";function l(e,s,i){if(e===s)return!0;let n=e.length;if(n!==s.length)return!1;for(let r=0;r<n;r++)if(!i?.includes(e[r])&&e[r]!==s[r])return!1;return!0}function f(e){let s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i="";for(let n=0;n<e.byteLength;n+=3){let r=0,a=0;for(let o=0;o<3&&n+o<e.byteLength;o++)r=r<<8|e[n+o],a+=8;for(let o=0;o<4;o++)a>=6?(i+=s[r>>a-6&63],a-=6):a>0&&(i+=s[r<<6-a&63],a=0)}return i}function j(e){let s=`${e.domain} wants you to sign in with your Aptos account:
`;s+=`${e.address}`,e.statement&&(s+=`

${e.statement}`);let i=[];if(e.uri&&i.push(`URI: ${e.uri}`),e.version&&i.push(`Version: ${e.version}`),e.nonce&&i.push(`Nonce: ${e.nonce}`),e.issuedAt&&i.push(`Issued At: ${e.issuedAt}`),e.expirationTime&&i.push(`Expiration Time: ${e.expirationTime}`),e.notBefore&&i.push(`Not Before: ${e.notBefore}`),e.requestId&&i.push(`Request ID: ${e.requestId}`),e.chainId&&i.push(`Chain ID: ${e.chainId}`),e.resources){i.push("Resources:");for(let n of e.resources)i.push(`- ${n}`)}return i.length&&(s+=`

${i.join(`
`)}`),s}var w="(?<domain>[^\\n]+?) wants you to sign in with your Aptos account:\\n",$="(?<address>[^\\n]+)(?:\\n|$)",R="(?:\\n(?<statement>[\\S\\s]*?)(?:\\n|$))??",T="(?:\\nURI: (?<uri>[^\\n]+))?",K="(?:\\nVersion: (?<version>[^\\n]+))?",k="(?:\\nNonce: (?<nonce>[^\\n]+))?",v="(?:\\nIssued At: (?<issuedAt>[^\\n]+))?",z="(?:\\nExpiration Time: (?<expirationTime>[^\\n]+))?",V="(?:\\nNot Before: (?<notBefore>[^\\n]+))?",O="(?:\\nRequest ID: (?<requestId>[^\\n]+))?",M="(?:\\nChain ID: (?<chainId>[^\\n]+))?",U="(?:\\nResources:(?<resources>(?:\\n- [^\\n]+)*))?",N=`${T}${K}${k}${v}${z}${V}${O}${M}${U}`,q=new RegExp(`^${w}${$}${R}${N}\\n*$`);function P(e){let s=q.exec(e);if(!s)return{valid:!1,errors:["invalid_message"]};let i=s.groups;if(!i)return{valid:!1,errors:["invalid_message"]};let n=[];return(!i.domain||i.domain==="undefined")&&n.push("message_domain_missing"),(!i.address||i.address==="undefined")&&n.push("message_address_missing"),(!i.version||i.version==="undefined")&&n.push("message_version_missing"),(!i.chainId||i.chainId==="undefined")&&n.push("message_chain_id_missing"),n.length?{valid:!1,errors:n}:{valid:!0,data:{domain:i.domain,address:i.address,statement:i.statement,uri:i.uri,version:i.version,nonce:i.nonce,chainId:i.chainId,issuedAt:i.issuedAt,expirationTime:i.expirationTime,notBefore:i.notBefore,requestId:i.requestId,resources:i.resources?.split(`
- `).slice(1)}}}function D(e,s,i){let n=P(s);if(!n.valid)return n;let r=[];return e.address&&e.address!==n.data.address&&r.push("message_address_mismatch"),e.statement!==n.data.statement&&r.push("message_statement_mismatch"),e.uri&&e.uri!==n.data.uri&&r.push("message_uri_mismatch"),e.version&&e.version!==n.data.version&&r.push("message_version_mismatch"),e.chainId&&e.chainId!==n.data.chainId&&r.push("message_chain_id_mismatch"),e.nonce!==n.data.nonce&&r.push("message_nonce_mismatch"),e.issuedAt!==n.data.issuedAt&&r.push("message_issued_at_mismatch"),e.expirationTime!==n.data.expirationTime&&r.push("message_expiration_time_mismatch"),e.notBefore!==n.data.notBefore&&r.push("message_not_before_mismatch"),e.requestId!==n.data.requestId&&r.push("message_request_id_mismatch"),e.domain&&e.domain!==n.data.domain&&r.push("message_domain_mismatch"),e.resources?n.data.resources?l(e.resources,n.data.resources,i?.excludedResources)||r.push("message_resources_mismatch"):r.push("message_resources_missing"):n.data.resources&&r.push("message_resources_unexpected"),r.length?{valid:!1,errors:r}:{valid:!0,data:n.data}}function L(e,s,i){let n=D(e,s.message,i);return n.valid?s.publicKey.verifySignature({message:B(s.message),signature:s.signature})?{valid:!0,data:n.data}:{valid:!1,errors:["invalid_signature"]}:n}function B(e){let i=b("SIGN_IN_WITH_APTOS::");return new Uint8Array([...i,...new TextEncoder().encode(e)])}import{SigningScheme as t,Ed25519PublicKey as u,MultiEd25519PublicKey as d,AnyPublicKey as c,MultiKey as g,Hex as S,Deserializer as h,Ed25519Signature as m,MultiEd25519Signature as p,AnySignature as y,MultiKeySignature as I}from"@aptos-labs/ts-sdk";var _=e=>e==="ed25519"||e==="multi_ed25519"||e==="single_key"||e==="multi_key";function W(e){if(typeof e=="object"){if(u.isInstance(e))return"ed25519";if(c.isInstance(e))return"single_key";if(g.isInstance(e))return"multi_key";if(e instanceof d)return"multi_ed25519";throw new Error(`Unknown public key type for instance: ${e}`)}switch(e){case t.Ed25519:return"ed25519";case t.MultiEd25519:return"multi_ed25519";case t.SingleKey:return"single_key";case t.MultiKey:return"multi_key";default:throw new Error(`Unknown public key type for signing scheme: ${e}`)}}function x(e,s){let i=new h(S.fromHexInput(s).toUint8Array());if(typeof e!="string")switch(e){case t.Ed25519:return u.deserialize(i);case t.MultiEd25519:return d.deserialize(i);case t.SingleKey:return c.deserialize(i);case t.MultiKey:return g.deserialize(i);default:throw new Error(`Unknown public key type for signing scheme: ${e}`)}switch(e){case"ed25519":return u.deserialize(i);case"multi_ed25519":return d.deserialize(i);case"single_key":return c.deserialize(i);case"multi_key":return g.deserialize(i);default:throw new Error(`Unknown public key type: ${e}`)}}function A(e,s){let i=new h(S.fromHexInput(s).toUint8Array());if(typeof e!="string")switch(e){case t.Ed25519:return m.deserialize(i);case t.MultiEd25519:return p.deserialize(i);case t.SingleKey:return y.deserialize(i);case t.MultiKey:return I.deserialize(i);default:throw new Error(`Unknown signature type for signing scheme: ${e}`)}switch(e){case"ed25519":return m.deserialize(i);case"multi_ed25519":return p.deserialize(i);case"single_key":return y.deserialize(i);case"multi_key":return I.deserialize(i);default:throw new Error(`Unknown signature type: ${e}`)}}function X(){let e=new Uint8Array(12);return crypto.getRandomValues(e),f(e)}var E="1",ee=e=>({version:E,type:e.type,signature:e.signature.bcsToHex().toString(),message:e.plainText,publicKey:e.account.publicKey.bcsToHex().toString()}),ie=e=>{let{version:s}=e;if(s===E){if(!_(e.type))throw new Error(`Unexpected public key scheme: ${e.type}`);return{type:e.type,signature:A(e.type,e.signature),publicKey:x(e.type,e.publicKey),message:e.message}}throw new Error(`Unexpected serialization version: ${s}`)};export{E as SERIALIZATION_VERSION,j as createSignInMessageText,ie as deserializeSignInOutput,x as deserializeSignInPublicKey,A as deserializeSignInSignature,X as generateNonce,B as generateSignInSigningMessage,W as getSignInPublicKeyScheme,_ as isValidPublicKeyScheme,P as parseSignInMessageText,ee as serializeSignInOutput,L as verifySignIn,D as verifySignInMessage};
//# sourceMappingURL=index.js.map