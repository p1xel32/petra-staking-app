import{c as k,u as W,as as z,j as e,T as M,ar as $}from"./chunk-OXe8fo8q.js";import{r as o}from"./chunk-3dRrDZpt.js";import{L as g,R as F}from"./chunk-CRHDTRgx.js";import{T as R}from"./chunk-DMhotx_d.js";import"./chunk-BlTxHScW.js";/* empty css              *//* empty css              *//**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],L=k("circle-check-big",D);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]],U=k("download",O);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]],q=k("trending-down",B),V=new z({network:$.MAINNET}),T="0xf747e3a6282cc0dee1c89239c529b039c64fe48e88b50e5cedd40e9c094800bb",p=1e8,l=11;function ee({account:c,onTransactionSuccess:w}){const{signAndSubmitTransaction:j}=W(),[r,A]=o.useState(""),[d,u]=o.useState(0),[s,N]=o.useState(!1),[f,x]=o.useState(null),[b,a]=o.useState(null),[h,v]=o.useState(!1),m=o.useCallback(async()=>{if(!c){u(0);return}v(!0),u(0);try{const t=await V.view({payload:{function:"0x1::delegation_pool::get_stake",functionArguments:[T,c]}});t&&Array.isArray(t)&&t.length>=2?u(Number(BigInt(t[1]))/p):u(0)}catch(t){console.error("Failed to fetch withdrawable amount:",t),u(0)}finally{v(!1)}},[c]);o.useEffect(()=>{m()},[c,m]);const y=async(t,C,E)=>{if(!c||s){a({message:"Wallet not connected or already submitting."});return}if(typeof j!="function"){a({message:"signAndSubmitTransaction function is not available."});return}N(!0),a(null),x(null);const I={data:{function:`0x1::delegation_pool::${C}`,functionArguments:[T,E],typeArguments:[]}};try{const n=await j(I);x({type:"success",message:`${t} successful! Tx hash: ${n.hash.substring(0,10)}...`}),m(),w&&w(),A("")}catch(n){let i=n.message||String(n);i.includes("User has rejected the request")||n&&n.code===4001?i="Transaction rejected by user.":n.errorCode==="invalid_argument"&&n.message&&n.message.includes("EDELEGATOR_ACTIVE_BALANCE_TOO_LOW")?i=`Stake amount is too low. Min ${l} APT.`:i.includes("Cannot use 'in' operator")&&(i="Internal adapter error. Please try again or check library versions."),console.error("Raw transaction error object:",n),a({message:`Error during ${t}: ${i}`})}finally{N(!1)}},S=()=>{const t=parseFloat(r);if(isNaN(t)||t<=0){a({message:"Please enter a valid amount > 0 to stake."});return}if(t<l){a({message:`Minimum stake amount is ${l} APT.`});return}y("Stake","add_stake",BigInt(Math.floor(t*p)))},_=()=>{const t=parseFloat(r);if(isNaN(t)||t<=0){a({message:"Please enter a valid amount > 0 to unstake."});return}y("Unstake","unlock",BigInt(Math.floor(t*p)))},P=()=>{if(d<=0){a({message:"No withdrawable amount available."});return}const t=BigInt(Math.floor(d*p));if(t<=0n){a({message:"Withdrawable amount is too small."});return}y("Withdraw","withdraw",t)};return e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-6 text-gray-100 text-center",children:"Manage Your Stake"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-400 mb-2",children:"Amount (APT)"}),e.jsx("div",{className:"relative",children:e.jsx("input",{type:"number",id:"amount",name:"amount",className:"w-full px-4 py-3 border border-gray-700 bg-gray-900 text-gray-100 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent placeholder-gray-500 text-lg transition-colors duration-150",placeholder:`e.g., ${l}`,value:r,onChange:t=>{A(t.target.value),a(null),x(null)},disabled:s,step:"any"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6",children:[e.jsxs("button",{onClick:S,disabled:s||!r||parseFloat(r)<=0||parseFloat(r)<l,className:"w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-xl shadow-lg hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 transition-all duration-150 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2 transform hover:scale-105",type:"button",children:[s?e.jsx(g,{size:20,className:"animate-spin"}):e.jsx(R,{size:20}),s?"Processing...":"Stake APT"]}),e.jsxs("button",{onClick:_,disabled:s||!r||parseFloat(r)<=0,className:"w-full px-6 py-3 bg-transparent border-2 border-purple-500/50 text-purple-400 font-bold rounded-xl hover:bg-purple-500/10 hover:text-purple-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500 transition-all duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",type:"button",children:[s?e.jsx(g,{size:20,className:"animate-spin"}):e.jsx(q,{size:20}),s?"Processing...":"Unstake APT"]})]}),e.jsxs("div",{className:"border-t border-gray-700 pt-6 mt-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["Withdrawable:",e.jsx("span",{className:`font-semibold ml-1 ${d>0?"text-green-400":"text-gray-400"}`,children:h?e.jsx(g,{size:14,className:"inline animate-spin"}):`${d.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:8})} APT`})]}),e.jsxs("button",{onClick:m,disabled:h||s,className:"text-xs text-blue-400 hover:text-blue-300 disabled:opacity-50 flex items-center gap-1 transition-colors duration-150",type:"button",children:[e.jsx(F,{size:14})," Refresh"]})]}),e.jsxs("button",{onClick:P,disabled:s||h||d<=0,className:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white font-bold rounded-xl shadow-lg hover:from-red-600 hover:to-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-pink-500 transition-all duration-150 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2",type:"button",children:[s?e.jsx(g,{size:20,className:"animate-spin"}):e.jsx(U,{size:20}),s?"Processing...":"Withdraw Available"]})]}),b&&b.message&&e.jsxs("div",{className:"mt-5 p-3 bg-red-800 bg-opacity-50 text-red-300 rounded-lg text-sm flex items-center gap-2 transition-opacity duration-300",children:[e.jsx(M,{size:18})," ",e.jsx("span",{children:b.message})]}),f&&f.message&&e.jsxs("div",{className:"mt-5 p-3 bg-green-800 bg-opacity-50 text-green-300 rounded-lg text-sm flex items-center gap-2 break-all transition-opacity duration-300",children:[e.jsx(L,{size:18})," ",e.jsx("span",{children:f.message})]}),e.jsxs("p",{className:"text-xs text-zinc-400 mt-6 text-center",children:["Note: Unstaking requires a lock-up period. Minimum stake is ",l," APT."]})]})}export{ee as default};
