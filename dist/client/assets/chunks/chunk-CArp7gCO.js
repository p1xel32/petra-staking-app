import{c as A,as as fe,j as e,ar as ye}from"./chunk-OXe8fo8q.js";import{r as s}from"./chunk-3dRrDZpt.js";import{I as ee}from"./chunk-DWBlJGs_.js";import{L as Ae,R as ke}from"./chunk-CRHDTRgx.js";import{P as ve}from"./chunk-CJ4K7xSE.js";import{T as be}from"./chunk-DMhotx_d.js";import{C as Ne,H as je}from"./chunk-Cz4cuXKR.js";import"./chunk-BlTxHScW.js";/* empty css              *//* empty css              *//**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Re=A("activity",Pe);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],_e=A("circle-alert",we);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Ce=A("external-link",Se);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=[["line",{x1:"3",x2:"21",y1:"22",y2:"22",key:"j8o0r"}],["line",{x1:"6",x2:"6",y1:"18",y2:"11",key:"10tf0k"}],["line",{x1:"10",x2:"10",y1:"18",y2:"11",key:"54lgf6"}],["line",{x1:"14",x2:"14",y1:"18",y2:"11",key:"380y"}],["line",{x1:"18",x2:"18",y1:"18",y2:"11",key:"1kevvc"}],["polygon",{points:"12 2 20 7 4 7",key:"jkujk7"}]],De=A("landmark",Ee);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],Ie=A("layers",Te);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],$e=A("package",Le);/**
 * @license lucide-react v0.508.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],Me=A("square-check-big",Fe),ze="https://rpc.mainnet.aptos.network/v1",j=new fe({network:ye.MAINNET,clientConfig:{NODE_URL:ze}}),P="0xf747e3a6282cc0dee1c89239c529b039c64fe48e88b50e5cedd40e9c094800bb",Q="0x1",X="0x1::staking_config::StakingConfig",Z="0x1::block::BlockResource",R=1e8,Ue=5*60;function Oe(o){if(o<=0)return"Unlocked";const n=Math.floor(o/(3600*24)),t=Math.floor(o%(3600*24)/3600),g=Math.floor(o%3600/60);let a=[];return n>0&&a.push(`${n}d`),t>0&&a.push(`${t}h`),(g>0||n===0&&t===0)&&a.push(`${g}m`),a.length>0?`in ${a.join(" ")}`:"Soon"}const x=({icon:o,label:n,value:t,valueClasses:g="text-gray-100 font-semibold",link:a=null,subValue:b=null,iconColor:N="text-purple-400",tooltipContent:k=null})=>e.jsxs("div",{className:"flex justify-between items-center py-2.5 border-b border-gray-700/60 last:border-b-0",children:[e.jsxs("span",{className:"text-gray-400 flex items-center text-sm",children:[o&&e.jsx(o,{size:16,className:`mr-2 ${N}`}),n,":"]}),a?e.jsxs("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:`font-mono text-sm break-all text-right ${g} hover:text-purple-300 transition-colors duration-150 flex items-center gap-1`,children:[t,e.jsx(Ce,{size:12})]}):e.jsxs("div",{className:"flex items-center justify-end text-right",children:[e.jsx("span",{className:`text-sm ${g}`,children:t}),k&&e.jsxs("span",{className:"ml-1.5 group relative cursor-help",children:[e.jsx(ee,{size:14,className:"text-gray-500 group-hover:text-gray-300"}),e.jsx("div",{className:`absolute bottom-full right-0 transform translate-y-0 mb-2 w-64 p-3 text-xs text-left
                          bg-gray-800 border border-gray-700 text-gray-300 rounded-md shadow-lg
                          opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10`,children:k})]}),b&&!k&&e.jsx("p",{className:"text-xs text-zinc-400 ml-1",children:b})]})]});function et({account:o,refreshTrigger:n}){const[t,g]=s.useState(null),[a,b]=s.useState(null),[N,k]=s.useState(null),[z,te]=s.useState(null),[w,se]=s.useState(null),[oe,_]=s.useState(0),[ae,S]=s.useState(0),[ne,C]=s.useState(0),[h,re]=s.useState(null),[E,D]=s.useState(!0),[T,U]=s.useState(!1),[O,Y]=s.useState(null),c=s.useRef({poolResources:null,poolCalculations:null,fetchTimestamp:0}),B=s.useRef(n),I=s.useCallback(async(f=!1)=>{f?U(!0):D(!0),Y(null);const q=Math.floor(Date.now()/1e3);let G=!1;try{let l,d,i,y,u,m,v;if(!f&&c.current.poolResources&&c.current.poolCalculations&&q-c.current.fetchTimestamp<Ue)console.log("Using cached pool data"),{delegationResData:l,poolResData:d,stakingConfigResData:i,blockInfoResData:y}=c.current.poolResources,{calculatedGrossAprNum:u,calculatedGrossApyNum:m,commissionRateValue:v}=c.current.poolCalculations,G=!0;else{console.log(f?"Force fetching fresh pool data":"Fetching fresh pool data (cache miss or stale)");const p=[j.getAccountResources({accountAddress:P}),j.getAccountResource({accountAddress:Q,resourceType:X}),j.getAccountResource({accountAddress:Q,resourceType:Z})],L=await Promise.all(p),H=L[0];i=L[1],y=L[2];const $=H.find(r=>r.type.startsWith("0x1::delegation_pool::DelegationPool")),F=H.find(r=>r.type==="0x1::stake::StakePool");if(!$||!F||!i||!y){let r=[];throw $||r.push("DelegationPool"),F||r.push("StakePool"),i||r.push(X),y||r.push(Z),new Error(`Required Aptos resources not found: ${r.join(", ")}.`)}if(l=$.data,d=F.data,!d||d.active===void 0||d.active.value===void 0)throw new Error("Stake pool data or its 'active.value' field is missing.");if(!l)throw new Error("Delegation pool data is missing.");if(i.rewards_rate===void 0||i.rewards_rate_denominator===void 0||y.epoch_interval===void 0)throw new Error("Could not find required fields for APR/APY calculation.");c.current.poolResources={delegationResData:l,poolResData:d,stakingConfigResData:i,blockInfoResData:y},v=Number(l.operator_commission_percentage)/1e4;const he=BigInt(i.rewards_rate),W=BigInt(i.rewards_rate_denominator),K=BigInt(y.epoch_interval);if(u=null,m=null,W!==0n&&K!==0n){const J=31536e3/Number(K/1000000n),M=Number(he)/Number(W);u=M*J*100,M>=0&&(m=(Math.pow(1+M,J)-1)*100)}else console.warn("Cannot calculate Aptos APR/APY due to zero denominator or epoch interval.");c.current.poolCalculations={calculatedGrossAprNum:u,calculatedGrossApyNum:m,commissionRateValue:v},c.current.fetchTimestamp=q}const me=BigInt(d.active.value),pe=Number(me)/R,xe=Number(l.operator_commission_percentage)/100,ge=Number(d.locked_until_secs);if(g({poolAddress:P,delegated:pe,commission:xe}),b(u!==null?u.toFixed(2):null),k(u!==null?(u*(1-v)).toFixed(2):null),te(m!==null?m.toFixed(2):null),se(m!==null?(m*(1-v)).toFixed(2):null),re(ge),o){G&&!f&&D(!0);const p=await j.view({payload:{function:"0x1::delegation_pool::get_stake",functionArguments:[P,o]}});Array.isArray(p)&&p.length>=3?(_(Number(BigInt(p[0]))/R),S(Number(BigInt(p[1]))/R),C(Number(BigInt(p[2]))/R)):(console.warn("Unexpected user stake result format from Aptos blockchain.",p),_(0),S(0),C(0))}else _(0),S(0),C(0)}catch(l){console.error("Error fetching Aptos pool/user data:",l),Y(l.message||"Failed to fetch or process Aptos staking data")}finally{D(!1),U(!1)}},[o]);s.useEffect(()=>{let f=!1;n!==B.current&&(console.log("Refresh triggered by 'refreshTrigger' prop change."),f=!0,B.current=n),I(f)},[o,n,I]);const le=()=>{I(!0)},ie=h?new Date(h*1e3).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",ce=Math.floor(Date.now()/1e3),V=h?h-ce:-1,de=h?Oe(V):"N/A";if(E&&!T&&!t)return e.jsxs("div",{className:"w-full text-center py-8",children:[e.jsx(Re,{size:36,className:"text-purple-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400 text-lg",children:"Loading Aptos Validator Info..."})]});if(O)return e.jsxs("div",{className:"w-full text-center py-8",children:[e.jsx(_e,{size:36,className:"text-red-400 mx-auto mb-4"}),e.jsxs("p",{className:"text-red-400 text-lg",children:["Error: ",O]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:"Could not load Aptos staking data. Please try again later."})]});if(!t&&!E)return e.jsxs("div",{className:"w-full text-center py-8",children:[e.jsx(ee,{size:36,className:"text-yellow-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Aptos validator pool information is currently unavailable."})]});const ue=t&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-semibold mb-1 text-sm",children:"Reward Calculation:"}),w&&e.jsx("p",{children:e.jsxs("strong",{children:["Est. Net APY: ",w,"%"]})}),t?.commission&&e.jsxs("p",{className:"text-xs",children:["(after ",t.commission.toFixed(2),"% commission, compounded)"]}),e.jsx("hr",{className:"my-1.5 border-gray-600"}),z&&e.jsxs("p",{className:"text-xs",children:["Est. Gross APY: ",z,"%"]}),N&&e.jsxs("p",{className:"text-xs",children:["Est. Net APR: ",N,"% (simple)"]}),a&&e.jsxs("p",{className:"text-xs",children:["Est. Gross APR: ",a,"% (simple)"]}),e.jsx("p",{className:"text-xs mt-1.5 italic",children:"APY includes compounding. APR is simple interest. All figures are estimates and may vary."})]});return e.jsxs("div",{className:"w-full text-gray-200",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-100",children:"Validator Pool Details"}),e.jsx("button",{onClick:le,disabled:T||E,className:"p-1.5 text-purple-400 hover:text-purple-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-150 rounded-md hover:bg-purple-500/10",title:"Refresh pool data",children:T?e.jsx(Ae,{size:20,className:"animate-spin"}):e.jsx(ke,{size:20})})]}),t&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3 mb-6",children:[e.jsx(x,{icon:De,label:"Validator Pool Address",value:`${t.poolAddress.substring(0,8)}...${t.poolAddress.substring(t.poolAddress.length-6)}`,valueClasses:"text-purple-300",link:`https://explorer.aptoslabs.com/validator/${P}?network=mainnet`}),e.jsx(x,{icon:Ie,label:"Total APT Delegated to Pool",value:`${t.delegated.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})} APT`}),e.jsx(x,{icon:ve,label:"Validator Commission Rate",value:`${t.commission.toFixed(2)} %`}),e.jsx(x,{icon:be,label:"Est. Net Yield",value:`${w??"N/A"}% APY`,valueClasses:"font-bold text-xl text-green-400",tooltipContent:ue}),e.jsx(x,{icon:Ne,label:"Pool Lockup Period Ends",value:ie,valueClasses:"text-gray-300",subValue:h&&V>0?de:h?"(Unlocked - Ready for unstake/withdraw)":null})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-6 border-t border-gray-700/60"}),e.jsx("h3",{className:"text-xl font-semibold mb-4 text-center text-gray-100",children:"Your Current Aptos (APT) Stake with aptcore.one"}),e.jsxs("div",{className:"space-y-2.5 text-sm",children:[e.jsx(x,{icon:Me,label:"Your Active APT Stake",value:`${oe.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:8})} APT`,valueClasses:"font-semibold text-green-400",iconColor:"text-green-400"}),e.jsx(x,{icon:je,label:"APT Pending Unstake",value:`${ne.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:8})} APT`,valueClasses:"font-semibold text-zinc-400",iconColor:"text-zinc-400"}),e.jsx(x,{icon:$e,label:"APT Ready to Withdraw",value:`${ae.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:8})} APT`,valueClasses:"font-semibold text-blue-400",iconColor:"text-blue-400"})]})]})]})]})}export{et as default};
