import{jsxs as a,jsx as t}from"react/jsx-runtime";import{useState as l,useCallback as z,useEffect as F}from"react";import{useWallet as D}from"@aptos-labs/wallet-adapter-react";import{Aptos as M,Network as $}from"@aptos-labs/ts-sdk";import{Loader2 as f,TrendingUp as j,TrendingDown as O,RefreshCw as R,Download as L,AlertTriangle as U,CheckCircle as B}from"lucide-react";/*! src/components/StakeUnstakeControls.jsx [vike:pluginModuleBanner] */const q=new M({network:$.MAINNET}),P="0xf747e3a6282cc0dee1c89239c529b039c64fe48e88b50e5cedd40e9c094800bb",p=1e8,c=11;function Q({account:d,onTransactionSuccess:A}){const{signAndSubmitTransaction:k}=D(),[o,N]=l(""),[u,m]=l(0),[s,v]=l(!1),[b,h]=l(null),[x,n]=l(null),[y,T]=l(!1),g=z(async()=>{if(!d){m(0);return}T(!0),m(0);try{const e=await q.view({payload:{function:"0x1::delegation_pool::get_stake",functionArguments:[P,d]}});e&&Array.isArray(e)&&e.length>=2?m(Number(BigInt(e[1]))/p):m(0)}catch(e){console.error("Failed to fetch withdrawable amount:",e),m(0)}finally{T(!1)}},[d]);F(()=>{g()},[d,g]);const w=async(e,E,I)=>{if(!d||s){n({message:"Wallet not connected or already submitting."});return}if(typeof k!="function"){n({message:"signAndSubmitTransaction function is not available."});return}v(!0),n(null),h(null);const W={data:{function:`0x1::delegation_pool::${E}`,functionArguments:[P,I],typeArguments:[]}};try{const r=await k(W);h({type:"success",message:`${e} successful! Tx hash: ${r.hash.substring(0,10)}...`}),g(),A&&A(),N("")}catch(r){let i=r.message||String(r);i.includes("User has rejected the request")||r&&r.code===4001?i="Transaction rejected by user.":r.errorCode==="invalid_argument"&&r.message&&r.message.includes("EDELEGATOR_ACTIVE_BALANCE_TOO_LOW")?i=`Stake amount is too low. Min ${c} APT.`:i.includes("Cannot use 'in' operator")&&(i="Internal adapter error. Please try again or check library versions."),console.error("Raw transaction error object:",r),n({message:`Error during ${e}: ${i}`})}finally{v(!1)}},S=()=>{const e=parseFloat(o);if(isNaN(e)||e<=0){n({message:"Please enter a valid amount > 0 to stake."});return}if(e<c){n({message:`Minimum stake amount is ${c} APT.`});return}w("Stake","add_stake",BigInt(Math.floor(e*p)))},C=()=>{const e=parseFloat(o);if(isNaN(e)||e<=0){n({message:"Please enter a valid amount > 0 to unstake."});return}w("Unstake","unlock",BigInt(Math.floor(e*p)))},_=()=>{if(u<=0){n({message:"No withdrawable amount available."});return}const e=BigInt(Math.floor(u*p));if(e<=0n){n({message:"Withdrawable amount is too small."});return}w("Withdraw","withdraw",e)};return a("div",{className:"w-full",children:[t("h2",{className:"text-2xl font-semibold mb-6 text-gray-100 text-center",children:"Manage Your Stake"}),a("div",{className:"mb-6",children:[t("label",{htmlFor:"amount",className:"block text-sm font-medium text-gray-400 mb-2",children:"Amount (APT)"}),t("div",{className:"relative",children:t("input",{type:"number",id:"amount",name:"amount",className:"w-full px-4 py-3 border border-gray-700 bg-gray-900 text-gray-100 rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent placeholder-gray-500 text-lg transition-colors duration-150",placeholder:`e.g., ${c}`,value:o,onChange:e=>{N(e.target.value),n(null),h(null)},disabled:s,step:"any"})})]}),a("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6",children:[a("button",{onClick:S,disabled:s||!o||parseFloat(o)<=0||parseFloat(o)<c,className:"w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white font-bold rounded-xl shadow-lg hover:from-purple-700 hover:to-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-indigo-500 transition-all duration-150 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2 transform hover:scale-105",type:"button",children:[s?t(f,{size:20,className:"animate-spin"}):t(j,{size:20}),s?"Processing...":"Stake APT"]}),a("button",{onClick:C,disabled:s||!o||parseFloat(o)<=0,className:"w-full px-6 py-3 bg-transparent border-2 border-purple-500/50 text-purple-400 font-bold rounded-xl hover:bg-purple-500/10 hover:text-purple-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-purple-500 transition-all duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",type:"button",children:[s?t(f,{size:20,className:"animate-spin"}):t(O,{size:20}),s?"Processing...":"Unstake APT"]})]}),a("div",{className:"border-t border-gray-700 pt-6 mt-6",children:[a("div",{className:"flex justify-between items-center mb-3",children:[a("p",{className:"text-sm text-gray-400",children:["Withdrawable:",t("span",{className:`font-semibold ml-1 ${u>0?"text-green-400":"text-gray-400"}`,children:y?t(f,{size:14,className:"inline animate-spin"}):`${u.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:8})} APT`})]}),a("button",{onClick:g,disabled:y||s,className:"text-xs text-blue-400 hover:text-blue-300 disabled:opacity-50 flex items-center gap-1 transition-colors duration-150",type:"button",children:[t(R,{size:14})," Refresh"]})]}),a("button",{onClick:_,disabled:s||y||u<=0,className:"w-full px-6 py-3 bg-gradient-to-r from-red-500 to-pink-600 text-white font-bold rounded-xl shadow-lg hover:from-red-600 hover:to-pink-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-pink-500 transition-all duration-150 ease-in-out disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2",type:"button",children:[s?t(f,{size:20,className:"animate-spin"}):t(L,{size:20}),s?"Processing...":"Withdraw Available"]})]}),x&&x.message&&a("div",{className:"mt-5 p-3 bg-red-800 bg-opacity-50 text-red-300 rounded-lg text-sm flex items-center gap-2 transition-opacity duration-300",children:[t(U,{size:18})," ",t("span",{children:x.message})]}),b&&b.message&&a("div",{className:"mt-5 p-3 bg-green-800 bg-opacity-50 text-green-300 rounded-lg text-sm flex items-center gap-2 break-all transition-opacity duration-300",children:[t(B,{size:18})," ",t("span",{children:b.message})]}),a("p",{className:"text-xs text-zinc-400 mt-6 text-center",children:["Note: Unstaking requires a lock-up period. Minimum stake is ",c," APT."]})]})}export{Q as default};
