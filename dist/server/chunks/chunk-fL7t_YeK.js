import{AptosConfig as f,Network as g,Aptos as h}from"@aptos-labs/ts-sdk";/*! src/services/aptosService.js [vike:pluginModuleBanner] */const m="https://fullnode.mainnet.aptoslabs.com/v1",_=new f({network:g.MAINNET,fullnode:m}),a=new h(_),s="0x1",w="0x1::staking_config::StakingConfig",S="0x1::block::BlockResource",l="0x1::stake::StakePool",v="0x03ae4db29ed4ae33d323568895aa00337e658e348b37509f5372ae51f0af00d5",k=`https://hermes.pyth.network/api/latest_price_feeds?ids[]=${v}`,E=async()=>{try{const e=await a.getAccountResource({accountAddress:s,resourceType:w});if(!e||e.recurring_lockup_duration_secs===void 0)throw console.error("aptosService: StakingConfig data not found or missing 'recurring_lockup_duration_secs'. Received:",e),new Error("aptosService: StakingConfig data not found or incomplete.");return e}catch(e){throw console.error("aptosService: Error fetching StakingConfig:",e.message,e),e.message&&(e.message.includes("Resource not found")||e.toString().includes("HTTPError: 404")||e.errorCode==="resource_not_found")?new Error(`aptosService: StakingConfig resource not found at address ${s}.`):e}},p=async()=>{try{const e=await a.getAccountResource({accountAddress:s,resourceType:S});if(!e||e.epoch_interval===void 0)throw console.error("aptosService: BlockResource data not found or missing 'epoch_interval'. Received:",e),new Error("aptosService: BlockResource data not found or missing 'epoch_interval'.");return e}catch(e){throw console.error("aptosService: Error fetching BlockResource:",e.message,e),e.message&&(e.message.includes("Resource not found")||e.toString().includes("HTTPError: 404")||e.errorCode==="resource_not_found")?new Error(`aptosService: BlockResource resource not found at address ${s}.`):e}},y=async()=>{try{const e=await E(),r=await p();if(!e||!r||r.epoch_interval===void 0)throw console.error("aptosService: Failed to fetch StakingConfig or complete BlockResource for APY. StakingConfig:",e,"BlockInfo:",r),new Error("aptosService: Could not fetch necessary on-chain data for APY calculation.");if(e.rewards_rate===void 0||e.rewards_rate_denominator===void 0)throw console.error("aptosService: Required fields for APY calculation are missing from StakingConfig.",{stakingConfigData:e}),new Error("aptosService: Missing APY fields in StakingConfig.");const o=BigInt(e.rewards_rate),t=BigInt(e.rewards_rate_denominator),c=BigInt(r.epoch_interval);if(t===0n||c===0n)return 0;const n=Number(c/1000000n);if(n===0)return 0;const i=31536e3/n,d=Number(o)/Number(t);let u=0;return d>=0&&(u=(Math.pow(1+d,i)-1)*100),u}catch(e){throw console.error("aptosService: Error in getDefaultApy:",e.message,e),e}},R=async()=>{try{const e=await fetch(k);if(!e.ok)throw new Error(`aptosService: Pyth Hermes API request failed with status ${e.status}`);const r=await e.json();if(!r||!Array.isArray(r)||r.length===0)throw new Error("aptosService: No price data returned from Pyth Hermes API.");const o=r[0]?.price;if(!o||o.price===void 0||o.expo===void 0)throw console.error("aptosService: Invalid price data structure from Pyth Hermes API.",r[0]),new Error("aptosService: Invalid price data from Pyth Hermes API.");return Number(o.price)*Math.pow(10,o.expo)}catch(e){throw console.error("aptosService: Error in getAptPrice (Pyth Hermes API):",e.message,e),e}},I=async()=>{try{const e=await p(),r=await a.getLedgerInfo();if(!r||typeof r.epoch!="string"&&typeof r.epoch!="number"||typeof r.ledger_timestamp!="string"&&typeof r.ledger_timestamp!="number")throw console.error("aptosService: Missing or invalid epoch or ledger_timestamp in ledger info. Received:",r),new Error("aptosService: Missing or invalid epoch or ledger_timestamp in ledger info.");const o=BigInt(e.epoch_interval);if(o===0n)throw new Error("aptosService: epoch_interval is zero, cannot calculate epoch timing.");const t=BigInt(r.ledger_timestamp),c=Number(t/1000n),n=t-t%o,i=n+o;return{currentEpoch:Number(r.epoch),epochStartTime:new Date(Number(n/1000n)),epochEndTime:new Date(Number(i/1000n)),epochIntervalMicroseconds:e.epoch_interval,dataAsOfTimestamp:new Date(c)}}catch(e){throw console.error("aptosService: Failed to fetch epoch timing:",e.message,e),e}},T=async e=>{try{const r=await a.getAccountResource({accountAddress:e,resourceType:l});if(!r||r.locked_until_secs===void 0)throw console.error(`aptosService: StakePool data incomplete or 'locked_until_secs' missing for ${e}. Received:`,r),new Error(`aptosService: StakePool data incomplete for ${e}.`);return{poolAddress:e,locked_until_secs:Number(r.locked_until_secs),active_stake_octas:r.active?.value||"0"}}catch(r){throw console.error(`aptosService: Error fetching StakePool for ${e}:`,r.message,r),r.message&&(r.message.includes("Resource not found")||r.toString().includes("HTTPError: 404")||r.errorCode==="resource_not_found")?new Error(`aptosService: StakePool resource type ${l} not found at address ${e}.`):r}};export{R as a,E as b,I as c,T as d,y as g};
